<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜é›…äººç”Ÿé‡å¼€æ¨¡æ‹Ÿå™¨ v3.0 ğŸ§</title>
    <style>
        :root {
            /* é»˜è®¤é«˜é›…é…è‰² */
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --primary: #2c3e50;
            --text-main: #333;
            --accent: #d35400;
            --highlight-bg: rgba(231, 76, 60, 0.08);
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-main);
            transition: background-color 1s ease, color 1s ease;
            background-image: radial-gradient(#dce4ec 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* --- ä¸–ç•Œçº¿å˜åŠ¨ç‰¹æ•ˆ CSS --- */
        body.mode-xiuxian { --bg-color: #e0f7fa; --primary: #006064; --card-bg: #e0f2f1; background-image: none; }
        body.mode-2d { --bg-color: #fce4ec; --primary: #880e4f; --card-bg: #fff0f5; background-image: none; }
        body.mode-horror { --bg-color: #212121; --primary: #000; --card-bg: #303030; --text-main: #cfd8dc; background-image: none; --highlight-bg: rgba(255, 0, 0, 0.2); }

        .container {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            border-radius: 24px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
            position: relative;
            transition: background 1s ease, color 1s ease, box-shadow 1s ease;
        }

        /* å¤´éƒ¨é«˜é›…æ  */
        .header {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background 1s ease;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .penguin-icon { font-size: 1.5rem; animation: waddle 1s infinite alternate; }
        @keyframes waddle { from { transform: rotate(-10deg); } to { transform: rotate(10deg); } }

        /* å±å¹•é€šç”¨ */
        .screen { padding: 25px; flex: 1; display: none; flex-direction: column; overflow-y: auto; }
        .screen.active { display: flex; }

        /* é¦–é¡µ Start Screen */
        .start-screen { text-align: center; justify-content: center; }
        .meme-banner { font-size: 70px; margin: 20px 0; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }
        .subtitle { font-size: 0.9rem; color: #666; margin-top: 10px; font-style: italic; }
        .version-info { margin-top: 30px; font-size: 0.8rem; color: #999; text-align: left; background: #f8f9fa; padding: 15px; border-radius: 10px; }
        .special-hint { color: var(--accent); font-weight: bold; }

        /* æŒ‰é’® */
        .btn {
            background: var(--primary); color: white; border: none; padding: 16px 32px; font-size: 1.05rem;
            border-radius: 50px; cursor: pointer; margin-top: 25px; box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transition: all 0.2s; font-weight: bold; letter-spacing: 1px;
        }
        .btn:active { transform: scale(0.98); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #restart-btn { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: none; z-index: 100; width: 85%; }

        /* è®¾ç½®ç•Œé¢ Setup Screen */
        .setup-screen h2 { text-align: center; margin-bottom: 25px; color: var(--primary); }
        .gender-select { display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; }
        .gender-btn { padding: 10px 20px; border: 2px solid #ddd; background: transparent; border-radius: 12px; cursor: pointer; color: var(--text-main); font-weight: bold; transition: all 0.2s; }
        .gender-btn.selected { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 10px rgba(44, 62, 80, 0.3); }
        .points-counter { text-align: center; font-weight: bold; margin-bottom: 20px; font-size: 1.1rem; }

        .stat-row { margin-bottom: 18px; display: flex; align-items: center; gap: 12px; background: #f8f9fa; padding: 10px; border-radius: 12px; }
        .stat-label { width: 60px; font-weight: bold; display: flex; align-items: center; gap: 5px; }
        input[type="range"] { flex: 1; accent-color: var(--primary); cursor: pointer; height: 6px; }
        .stat-val { font-weight: bold; color: var(--primary); width: 30px; text-align: right;}

        /* æ¸¸æˆä¸»ç•Œé¢ Game Screen */
        #log-container { flex: 1; overflow-y: auto; padding-bottom: 80px; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
        .log-item {
            padding: 12px 5px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            font-size: 0.95rem;
            line-height: 1.6;
            opacity: 0;
            animation: slideUp 0.4s ease-out forwards;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .age-tag {
            display: inline-block; background: var(--primary); color: white; padding: 3px 8px; border-radius: 6px;
            font-size: 0.75rem; margin-right: 10px; min-width: 32px; text-align: center; font-weight: bold;
        }

        /* --- æ–‡å­—ç‰¹æ•ˆ --- */
        .highlight { color: #c0392b; font-weight: bold; background: var(--highlight-bg); padding: 2px 6px; border-radius: 4px; }
        .golden { color: #dda928; font-weight: 900; text-shadow: 1px 1px 0 rgba(0,0,0,0.1); font-size: 1.05rem; background: linear-gradient(to right, rgba(255,255,255,0), rgba(241, 196, 15, 0.15), rgba(255,255,255,0)); }
        
        /* ä¸–ç•Œçº¿ä¸“å±å­—ä½“é£æ ¼ */
        .xiuxian-text { color: #00796b; font-family: "KaiTi", "STKaiti", serif; font-weight: bold; font-size: 1.02rem; }
        .anime-text { color: #d81b60; font-style: italic; }
        .horror-text { color: #b0bec5; font-family: "Courier New", monospace; letter-spacing: -0.5px; }
        .horror-text strong { color: #ff3d00; text-shadow: 0 0 5px #ff3d00; } /* ææ€–é‡ç‚¹ */

    </style>
</head>
<body>

<div class="container">
    <div class="header" id="header-bar">
        <span class="penguin-icon">ğŸ§</span>
        <span id="title-text">é«˜é›…äººç”Ÿæ¨¡æ‹Ÿå™¨</span>
        <span class="penguin-icon">ğŸ·</span>
    </div>

    <div id="screen-start" class="screen active start-screen">
        <div class="meme-banner">ğŸ•´ï¸ğŸ²ğŸ¦‘</div>
        <h1>äººç”Ÿé‡å¼€ v3.0</h1>
        <p class="subtitle">â€œåšäººå¤ªç´¯äº†ï¼Œä¸å¦‚åšä¸ªé«˜é›…çš„ä¼é¹…ã€‚â€</p>
        
        <div class="version-info">
            <strong>æœ¬å‘¨ç›®ç‰¹è‰²ï¼š</strong><br>
            â€¢ å¯è½¬ç”Ÿä¸ºéäººç±»ç‰©ç§ï¼ˆä¼é¹…ã€èŸ‘è‚ç­‰ï¼‰<br>
            â€¢ å¼•å…¥éšæœºæš´æ¯™ç³»ç»Ÿï¼Œç”Ÿå‘½æ— å¸¸<br>
            â€¢ <span class="special-hint">è­¦å‘Šï¼šè¿è¡Œä¸­æœ‰æ¦‚ç‡å‘ç”Ÿä¸–ç•Œçº¿å˜åŠ¨ï¼Œè¿›å…¥ï¼ˆä¿®ä»™ã€äºŒæ¬¡å…ƒã€è¯¡å¼‚â€¦â€¦ï¼‰ç­‰ç‰¹æ®Šä½é¢ã€‚</span>
        </div>
        
        <button class="btn" onclick="goToSetup()">å¼€å§‹æŠ½å¡</button>
    </div>

    <div id="screen-setup" class="screen setup-screen">
        <h2>å®šåˆ¶ä½ çš„å¤©èµ‹ (20ç‚¹)</h2>
        <div class="gender-select">
            <button class="gender-btn selected" onclick="selectGender('male', this)">ç”·</button>
            <button class="gender-btn" onclick="selectGender('female', this)">å¥³</button>
            <button class="gender-btn" onclick="selectGender('other', this)" title="å¯èƒ½ä¼šå˜æˆå¥‡æ€ªçš„ä¸œè¥¿">???</button>
        </div>
        
        <div class="points-counter" style="color:var(--accent)">
            å‰©ä½™ç‚¹æ•°: <span id="points-display">20</span>
        </div>

        <div id="sliders-container">
            </div>

        <button class="btn" onclick="startGame()">å¼€å¯éšæœºäººç”Ÿ</button>
    </div>

    <div id="screen-game" class="screen game-screen">
        <div id="log-container">
            </div>
        <button id="restart-btn" class="btn" onclick="resetGame()">å†æ¬¡é‡å¼€</button>
    </div>
</div>

<script>
    // ================= é…ç½®åŒº =================
    const TOTAL_POINTS = 20;
    const statConfig = [
        { key: 'face', name: 'é¢œå€¼', icon: 'ğŸ’…' },
        { key: 'iq', name: 'æ™ºå•†', icon: 'ğŸ§ ' },
        { key: 'body', name: 'ä½“è´¨', icon: 'ğŸ’ª' },
        { key: 'money', name: 'å®¶å¢ƒ', icon: 'ğŸ’°' },
        { key: 'luck', name: 'æ°”è¿', icon: 'ğŸ€' }
    ];
    
    // ç‰©ç§åˆ—è¡¨ (v1.0ç‰¹æ€§)
    const speciesList = ['é«˜é›…ä¼é¹…', 'æ°´è±š', 'èµ›åšèŸ‘è‚', 'ä¸€æ£µæ ‘', 'å²è±å§†', 'ä¸å¯åçŠ¶ä¹‹ç‰©'];

    // ================= çŠ¶æ€åŒº =================
    let remainingPoints = TOTAL_POINTS;
    let stats = { face:0, iq:0, body:0, money:0, luck:0 };
    let selectedGenderTag = 'male'; // ç”¨äºUIé€‰æ‹©
    let finalGenderOrSpecies = 'äººç±»ç”·æ€§'; // å®é™…æ¸¸æˆä¸­çš„èº«ä»½
    let age = 0;
    let isDead = false;
    let gameInterval = null;
    let currentMode = 'normal'; // normal, xiuxian, 2d, horror
    let lastEventHash = ""; // é˜²é‡å¤

    // ================= äº‹ä»¶åº“ (V2.0 & V1.0 èåˆ) =================
    
    // é€šç”¨äººç±»äº‹ä»¶
    const humanEvents = [
        "ä½ æ²‰è¿·äºç½‘ç»œä¸Šçš„é«˜é›…è‰ºæœ¯é‰´èµè§†é¢‘ï¼Œè™½ç„¶ä½ çœ‹ä¸æ‡‚ã€‚",
        "èµ°è·¯æ—¶ä¸ºäº†èº²é¿ä¸€åªèš‚èšï¼Œä½ æ‘”äº†ä¸ªç‹—åƒå±ï¼Œä½†å§¿åŠ¿å¾ˆä¼˜é›…ã€‚",
        "ä½ è¯•å›¾å­¦åšé¥­ï¼Œç»“æœç‚¸äº†å¨æˆ¿ï¼Œé»‘ç€è„¸èµ°å‡ºæ¥æ—¶åƒä¸ªæŒ–ç…¤çš„ã€‚",
        "ä½ åœ¨ç½‘ä¸Šå‘è¡¨äº†ä¸€ç¯‡å…³äº'å¦‚ä½•ä¼˜é›…åœ°åƒæ³¡é¢'çš„å¸–å­ï¼Œè·å¾—äº†10ä¸‡+ç‚¹èµã€‚",
        "å› ä¸ºåœ¨è¯¾å ‚ä¸Šç¡è§‰æµå£æ°´ï¼Œè¢«æ‹ä¸‹æ¥åšæˆäº†å…¨æ ¡æµä¼ çš„è¡¨æƒ…åŒ…ã€‚",
        "ä½ çˆ±ä¸Šäº†å–å’–å•¡ï¼Œè™½ç„¶æ¯æ¬¡éƒ½å·å·åŠ äº”å—æ–¹ç³–ã€‚",
        "å¹³æ·¡çš„ä¸€å¹´ï¼Œä½ æœ€å¤§çš„æˆå°±æ˜¯æ•™ä¼šäº†å®¶é‡Œçš„ç‹—æ¡æ‰‹ã€‚"
    ];

    // v1.0 ç‰¹è‰²ï¼šç‰©ç§ä¸“å±äº‹ä»¶
    const speciesEvents = {
        'é«˜é›…ä¼é¹…': [
            "ä½ ç©¿ä¸Šäº†ç‡•å°¾æœï¼Œæ··å…¥äº†äººç±»çš„é«˜çº§æ™šå®´ï¼Œæ²¡äººå‘ç°å¼‚å¸¸ã€‚",
            "ä½ åœ¨è…¾è®¯æ€»éƒ¨å¤§æ¥¼å‰å¾˜å¾Šï¼Œè¯•å›¾è®¤äº²ã€‚",
            "ä½ ä¼˜é›…åœ°åƒäº†ä¸€åªç£·è™¾ï¼Œå¹¶è¯„ä»·é“ï¼š'ä½é¤é…’å¹´ä»½ä¸å¯¹'ã€‚",
            "ä½ è¢«åšæˆäº†è¡¨æƒ…åŒ…ï¼Œåœ¨äº’è”ç½‘ä¸Šç–¯ä¼ ï¼Œæ ‡é¢˜æ˜¯ã€Šæ‰“å·¥äººçš„çœŸå®å†™ç…§ã€‹ã€‚",
            "ç”±äºå…¨çƒå˜æš–ï¼Œä½ ä¸å¾—ä¸æ¬å®¶ï¼Œè¿™å¾ˆä¸ä½“é¢ã€‚"
        ],
        'èµ›åšèŸ‘è‚': [
            "ä½ åœ¨æ ¸åºŸå¢Ÿä¸­é†’æ¥ï¼Œæ„Ÿè§‰æµ‘èº«å……æ»¡äº†æœºæ¢°åŠ›é‡ã€‚",
            "ä½ è¯•å›¾å•ƒé£Ÿç”µçº¿æ¥è¡¥å……èƒ½é‡ï¼Œè¢«ç”µå¾—é…¥éº»ã€‚",
            "å› ä¸ºå¤–å£³å¤ªç¡¬ï¼Œä½ å¡åœ¨äº†ä¸‹æ°´é“å£æ•´æ•´ä¸€å¹´ã€‚",
            "ä½ è¿›åŒ–å‡ºäº†å…‰å­¦è¿·å½©ï¼Œå¼€å§‹è§‚å¯Ÿäººç±»çš„æ„šè ¢è¡Œä¸ºã€‚",
            "è¢«æ›´é«˜é˜¶çš„æ‰«åœ°æœºå™¨äººè¿½æ€äº†ä¸€æ•´æ¡è¡—ã€‚"
        ],
        'ä¸€æ£µæ ‘': [
            "å…‰åˆä½œç”¨ä¸­... æ„Ÿè§‰çµé­‚å¾—åˆ°äº†å‡åã€‚",
            "ä¸€åªç‹—åœ¨ä½ è„šä¸‹æ’’äº†å°¿ï¼Œä½ å¾ˆæ„¤æ€’ä½†æ— æ³•ç§»åŠ¨ï¼Œåªèƒ½ç‹‚æ€’åœ°æ‰ä¸¤ç‰‡å¶å­ã€‚",
            "æœ‰äººåœ¨ä½ èº«ä¸Šåˆ»äº†'é˜¿å¼ºçˆ±é˜¿ç'ï¼Œä¿—ä¸å¯è€ï¼Œä½ æ„Ÿåˆ°å—åˆ°äº†ä¾®è¾±ã€‚",
            "å°é£æ¥äº†ï¼Œä½ çš„å‘å‹ï¼ˆæ ‘å† ï¼‰ä¹±äº†ã€‚",
            "ä¸€ç¾¤é¸Ÿåœ¨ä½ å¤´ä¸Šå®‰äº†å®¶ï¼Œæ¯å¤©å½å½å–³å–³åµå¾—ä½ ç¡ä¸ç€ã€‚"
        ]
    };

    // v2.0 ç‰¹è‰²ï¼šä¸–ç•Œçº¿äº‹ä»¶
    const xiuxianEvents = [
        { t: "ä½ æ„Ÿè§‰åˆ°ç©ºæ°”ä¸­æœ‰ä¸€ç§å¥‡æ€ªçš„æ³¢åŠ¨ï¼Œæ— å¸ˆè‡ªé€šäº†ã€å¼•æ°”å…¥ä½“ã€‘ï¼" },
        { t: "ä½ åœ¨åœ°æ‘Šä¸Šä¹°çš„å¤ç±ã€Šå¹¿æ’­ä½“æ“å¤§å…¨ã€‹é‡Œå¤¹ç€ä¸€å¼ é‡‘é¡µã€Šä¹è½¬é‡‘èº«å†³ã€‹ã€‚" },
        { t: "é—­å…³ä¿®ç‚¼ä¸­... å¢ƒç•Œæ¾åŠ¨ï¼Œå‘¨å›´çš„èšŠå­éƒ½è¢«ä½ çš„æ°”åŠ¿éœ‡æ­»äº†ã€‚" },
        { t: "è¯•å›¾çªç ´ç­‘åŸºæœŸï¼Œå¤©é™é›·åŠ«ï¼ä½ ä¸¾èµ·é¿é›·é’ˆç¡¬æŠ—äº†ä¸‹æ¥ã€‚" },
        { t: "ä½ å¾¡å‰‘é£è¡Œé€å¤–å–ï¼Œä»æœªè¶…æ—¶ï¼Œè·å¾—äº†'ç§‹åå±±å‰‘ç¥'çš„ç§°å·ã€‚" }
    ];

    const animeEvents = [
        { t: "ä¸€è¾†å¡è½¦å†²ä½ æ’æ¥ï¼ä½ å¿ƒæƒ³ï¼š'ä¸šç»©æ¥äº†ï¼' ç»“æœå¡è½¦åœ¨ä½ é¢å‰æ€¥åˆ¹è½¦ï¼Œå¸æœºæŠŠä½ éª‚äº†ä¸€é¡¿ã€‚" },
        { t: "æ—©ä¸Šé†’æ¥ï¼Œå‘ç°åºŠè¾¹åç€ä¸€ä¸ªé‡‘å‘åŒé©¬å°¾å°‘å¥³ï¼ŒæŒ‡ç€ä½ è¯´ï¼š'åº¶æ°‘ï¼Œç»™æˆ‘åšæ—©é¥­ï¼'" },
        { t: "èµ°åœ¨è·¯ä¸Šï¼Œçªç„¶å¤©é™ç¾å°‘å¥³/ç¾å°‘å¹´ï¼Œæ­£å¥½ç ¸åœ¨ä½ æ€€é‡Œã€‚ç‰©ç†å­¦ä¸å­˜åœ¨äº†ã€‚" },
        { t: "å­¦æ ¡é‡Œè½¬æ¥ä¸€ä¸ªç¥ç§˜è½¬æ ¡ç”Ÿï¼Œååœ¨åæ’é çª—çš„ä½ç½®ï¼ˆç‹çš„æ•…ä¹¡ï¼‰ã€‚" }
    ];

    const horrorEvents = [
        { t: "ä»Šæ™šçš„æœˆäº®æ˜¯çº¢è‰²çš„ã€‚ä½ å¬åˆ°çª—å¤–æœ‰äººåœ¨ç”¨æŒ‡ç”²æŒ ç»ç’ƒï¼Œå£°éŸ³è¶Šæ¥è¶Šæ€¥ä¿ƒã€‚" },
        { t: "ç…§é•œå­æ—¶ï¼Œä½ çœ¨äº†çœ¼ï¼Œä½†é•œå­é‡Œçš„ä½ æ²¡æœ‰çœ¨çœ¼ï¼Œå®ƒåœ¨å†·å†·åœ°çœ‹ç€ä½ ã€‚" },
        { t: "èµ°å¤œè·¯å›å®¶ï¼Œæ€»æ„Ÿè§‰èº«åæœ‰è„šæ­¥å£°ï¼Œå›å¤´å´ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œå†è½¬å¤´ï¼Œä¸€å¼ è„¸è´´åœ¨ä½ é¼»å°–ä¸Šã€‚" },
        { t: "åŠå¤œé†’æ¥ï¼Œå‘ç°å¤©èŠ±æ¿ä¸Šå…¨æ˜¯å¯†å¯†éº»éº»çš„çœ¼ç›åœ¨ç›¯ç€ä½ ã€‚" },
        { t: "æ”¶åˆ°äº†æ¥è‡ªä½ æ­»å»å¤šå¹´çš„çˆ·çˆ·çš„çŸ­ä¿¡ï¼š'å¿«è·‘ï¼Œåˆ«å›å¤´'ã€‚" }
    ];


    // ================= é€»è¾‘æ§åˆ¶åŒº =================

    // --- åˆå§‹åŒ–ä¸è®¾ç½® ---
    function initSetup() {
        const container = document.getElementById('sliders-container');
        container.innerHTML = '';
        statConfig.forEach(stat => {
            container.innerHTML += `
                <div class="stat-row">
                    <label class="stat-label">${stat.icon} ${stat.name}</label>
                    <input type="range" min="0" max="10" value="0" data-key="${stat.key}" oninput="handleInput('${stat.key}', this.value)">
                    <span class="stat-val" id="val-${stat.key}">0</span>
                </div>`;
        });
        resetStatsUI();
    }

    function resetStatsUI() {
        remainingPoints = TOTAL_POINTS;
        for(let k in stats) stats[k] = 0;
        document.querySelectorAll('input[type="range"]').forEach(el => el.value = 0);
        document.querySelectorAll('.stat-val').forEach(el => el.innerText = '0');
        updatePointDisplay();
    }

    function handleInput(key, val) {
        val = parseInt(val);
        let used = 0;
        document.querySelectorAll('input[type="range"]').forEach(input => {
            if(input.dataset.key !== key) used += parseInt(input.value);
        });
        
        if (used + val > TOTAL_POINTS) {
            val = TOTAL_POINTS - used;
            document.querySelector(`input[data-key="${key}"]`).value = val;
        }
        
        stats[key] = val;
        document.getElementById(`val-${key}`).innerText = val;
        remainingPoints = TOTAL_POINTS - (used + val);
        updatePointDisplay();
    }

    function updatePointDisplay() {
        const pDisplay = document.getElementById('points-display');
        pDisplay.innerText = remainingPoints;
        pDisplay.style.color = remainingPoints === 0 ? '#27ae60' : '#d35400';
    }

    function selectGender(tag, btn) {
        selectedGenderTag = tag;
        document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
    }

    function switchScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
    }

    function goToSetup() { switchScreen('screen-setup'); }

    // --- æ¸¸æˆæ ¸å¿ƒå¾ªç¯ ---

    function startGame() {
        if (remainingPoints > 0) { alert("å±æ€§ç‚¹æ²¡åˆ†å®Œï¼åšäººï¼ˆæˆ–åšä¼é¹…ï¼‰è¦å…¨åŠ›ä»¥èµ´ï¼"); return; }
        
        switchScreen('screen-game');
        
        // é‡ç½®çŠ¶æ€
        age = -1; isDead = false; currentMode = 'normal';
        document.body.className = ''; // é‡ç½®èƒŒæ™¯
        document.getElementById('log-container').innerHTML = '';
        document.getElementById('restart-btn').style.display = 'none';
        document.getElementById('title-text').innerText = "é«˜é›…äººç”Ÿæ¨¡æ‹Ÿå™¨";

        // ç¡®å®šæœ€ç»ˆèº«ä»½ (v1.0 æ ¸å¿ƒé€»è¾‘)
        if (selectedGenderTag === 'other') {
            finalGenderOrSpecies = speciesList[Math.floor(Math.random() * speciesList.length)];
        } else {
            finalGenderOrSpecies = selectedGenderTag === 'male' ? 'äººç±»ç”·æ€§' : 'äººç±»å¥³æ€§';
        }

        addLog(`<strong>ç³»ç»ŸåŠ è½½æˆåŠŸã€‚</strong> è½¬ç”Ÿèº«ä»½:ã€${finalGenderOrSpecies}ã€‘ | é¢œå€¼:${stats.face} æ™ºå•†:${stats.iq} å®¶å¢ƒ:${stats.money} æ°”è¿:${stats.luck}`, false, false);
        
        // 0.5ç§’ä¸€è·³ (v1.0ç‰¹æ€§)
        gameInterval = setInterval(gameLoop, 500);
    }

    function gameLoop() {
        age++;
        const logBox = document.getElementById('log-container');
        
        // 1. éšæœºæš´æ¯™æ£€æµ‹ (v2.0ç‰¹æ€§)
        if (checkSuddenDeath()) return;

        // 2. æ­£å¸¸æ­»äº¡ä¸Šé™
        let maxAge = finalGenderOrSpecies.includes('äººç±»') ? 100 : (finalGenderOrSpecies === 'ä¸€æ£µæ ‘' ? 500 : 30);
        if (age > maxAge && Math.random() < 0.3) {
            die(`å¯¿ç»ˆæ­£å¯ã€‚ä½œä¸ºã€${finalGenderOrSpecies}ã€‘æ´»åˆ°äº†${age}å²ï¼Œä¹Ÿæ˜¯ä¸ªå¥‡è¿¹äº†ã€‚`);
            return;
        }

        // 3. äº‹ä»¶ç”Ÿæˆæ ¸å¿ƒ
        generateEvent();
        
        // UIæ›´æ–°
        logBox.scrollTop = logBox.scrollHeight;
    }

    // v2.0 æ ¸å¿ƒ: éšæœºæš´æ¯™ç³»ç»Ÿ
    function checkSuddenDeath() {
        if (age <= 0) return false;
        let deathChance = 0.002; // åŸºç¡€æ­»äº¡ç‡ 0.2%
        
        // å±æ€§å½±å“
        if (stats.body < 4) deathChance += (4 - stats.body) * 0.005;
        if (stats.luck < 3) deathChance += 0.008;

        // æ¨¡å¼å½±å“
        if (currentMode === 'horror') deathChance += 0.08; // ææ€–æ¨¡å¼ææ˜“æ­»äº¡
        if (currentMode === 'xiuxian') deathChance += 0.02; // ä¿®ä»™å®¹æ˜“ç‚¸

        // ç‰©ç§å½±å“
        if (!finalGenderOrSpecies.includes('äººç±»') && finalGenderOrSpecies !== 'ä¸€æ£µæ ‘') {
             deathChance += 0.03; // éäººç±»ï¼ˆé™¤äº†æ ‘ï¼‰æ›´å®¹æ˜“æ­»
        }

        if (Math.random() < deathChance) {
            let reason = "å–æ°´å‘›æ­»äº†ã€‚";
            if (currentMode === 'xiuxian') reason = "æ€¥äºæ±‚æˆï¼ŒçµåŠ›é€†æµï¼Œå½“åœºè‡ªçˆ†ï¼";
            if (currentMode === 'horror') reason = "è™½ç„¶ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½†ä½ çªç„¶æ¶ˆå¤±äº†ï¼Œåœ°ä¸Šåªå‰©ä¸‹ä¸€æ»©æ°´ã€‚";
            if (currentMode === '2d') reason = "è¢«ç—…å¨‡æ…äº†99åˆ€ã€‚";
            if (!finalGenderOrSpecies.includes('äººç±»')) {
                 reason = finalGenderOrSpecies === 'é«˜é›…ä¼é¹…' ? "è¢«æµ·è±¹å½“æˆè‡ªåŠ©é¤åƒäº†ã€‚" : "è¢«äººç±»ä¸€è„šè¸©æ‰äº†ã€‚";
            }
            
            die(`ã€çªå‘æ¶è®¯ã€‘${reason}`);
            return true;
        }
        return false;
    }

    function die(msg) {
        clearInterval(gameInterval);
        isDead = true;
        addLog(msg, true);
        const endBtn = document.getElementById('restart-btn');
        endBtn.style.display = 'block';
        // endBtn.innerHTML = `äº«å¹´ ${age} å² - å†æ¬¡é‡å¼€`;
    }

    // v2.0 & v1.0 èåˆ: äº‹ä»¶ç”Ÿæˆ
    function generateEvent() {
        let text = "";
        let styleClass = "";
        let isHighlight = false;
        let isGolden = false;

        // A. å°è¯•è§¦å‘ç‰¹æ®Šä¸–ç•Œçº¿ (ä»…åœ¨æ­£å¸¸æ¨¡å¼ä¸”äººç±»çŠ¶æ€ä¸‹è§¦å‘)
        if (currentMode === 'normal' && finalGenderOrSpecies.includes('äººç±»') && age > 5 && Math.random() < 0.08) {
            const roll = Math.random();
            if (roll < 0.33 && (stats.iq > 6 || stats.body > 6)) {
                switchMode('xiuxian');
                return addLog("ã€æœºç¼˜ã€‘ä½ åœ¨åœ°æ‘Šä¸Šä¹°åˆ°äº†ä¸€æœ¬å‘å…‰çš„ä¹¦ï¼Œä¸–ç•Œåœ¨ä½ çœ¼ä¸­å˜äº†æ¨¡æ ·ï¼è¿›å…¥ä¿®ä»™çº¿ï¼", false, true);
            } else if (roll < 0.66 && (stats.face > 7 || stats.luck > 7 || stats.luck < 3)) {
                switchMode('2d');
                return addLog("ã€å¼‚å˜ã€‘ç”»é£çªå˜ï¼å‘¨å›´çš„äººçœ¼ç›çªç„¶å˜å¾—å äº†è„¸çš„ä¸€åŠå¤§ã€‚è¿›å…¥äºŒæ¬¡å…ƒçº¿ï¼", false, true);
            } else if (roll > 0.8 || stats.luck < 4) {
                switchMode('horror');
                return addLog("ã€è­¦å‘Šã€‘å¤©è‰²çªç„¶æš—äº†ä¸‹æ¥ï¼Œå‘¨å›´å˜å¾—æ­»ä¸€èˆ¬å¯‚é™ã€‚è¯¡å¼‚é™ä¸´ï¼", true, true);
            }
        }

        // B. æ ¹æ®å½“å‰æ¨¡å¼å’Œç‰©ç§ç”Ÿæˆå†…å®¹
        if (currentMode === 'xiuxian') {
            text = getRandom(xiuxianEvents).t; styleClass = "xiuxian-text";
        } else if (currentMode === '2d') {
            text = getRandom(animeEvents).t; styleClass = "anime-text";
        } else if (currentMode === 'horror') {
            text = getRandom(horrorEvents).t; styleClass = "horror-text";
        } else {
            // Normal Mode Logic
            if (age === 0) {
                text = getBirthText();
            } else if (!finalGenderOrSpecies.includes('äººç±»')) {
                // v1.0 ç‰¹æ€§ï¼šéäººç±»ä¸“å±äº‹ä»¶åº“
                let pool = speciesEvents[finalGenderOrSpecies] || speciesEvents['èµ›åšèŸ‘è‚']; // fallback
                text = getRandom(pool);
            } else {
                // äººç±»é€šç”¨äº‹ä»¶
                if (age === 18) text = "18å²ï¼Œä½ æˆå¹´äº†ï¼Œæ„Ÿå¹æ—¶å…‰é£é€ï¼Œå†³å®šåšä¸ªé«˜é›…çš„äººã€‚";
                else if (Math.random() < 0.4) text = getStatEvent(); // åŸºäºå±æ€§çš„äº‹ä»¶
                else text = getRandom(humanEvents);
            }
        }

        // é˜²é‡å¤
        if (text === lastEventHash) {
            text = "è¿™ä¸€å¹´å¹³å¹³æ·¡æ·¡ï¼Œä½ åœ¨è¿™ä¸ªå–§åš£çš„ä¸–ç•Œé‡Œä¿æŒäº†å†…å¿ƒçš„å®é™ã€‚";
            styleClass = "";
        }
        lastEventHash = text;

        // å…³é”®è¯é«˜äº®åˆ¤æ–­
        if (text.includes("æ­»") || text.includes("æ€") || text.includes("è­¦å‘Š")) isHighlight = true;
        if (text.includes("ç¥") || text.includes("æœºç¼˜") || text.includes("é«˜é›…") || text.includes("å¯Œ")) isGolden = true;

        addLog(text, isHighlight, isGolden, styleClass);
    }

    function switchMode(mode) {
        currentMode = mode;
        document.body.className = `mode-${mode}`;
        const titles = { 'xiuxian': 'ä¿®ä»™æ¨¡æ‹Ÿå™¨ (ç‚¼æ°”æœŸ)', '2d': 'æ‹çˆ±å…»æˆæ¨¡æ‹Ÿå™¨', 'horror': 'è§„åˆ™æ€ªè°ˆæ¨¡æ‹Ÿå™¨' };
        document.getElementById('title-text').innerText = titles[mode] || 'é«˜é›…äººç”Ÿæ¨¡æ‹Ÿå™¨';
    }

    // --- è¾…åŠ©æ–‡æ¡ˆå‡½æ•° ---
    function getRandom(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

    function getBirthText() {
        if (!finalGenderOrSpecies.includes('äººç±»')) return `ä½ è½¬ç”Ÿæˆä¸ºäº†ã€${finalGenderOrSpecies}ã€‘ï¼Œæ„Ÿè§‰æ€ªæ€ªçš„ã€‚`;
        if (stats.money > 8) return "å«ç€é’»çŸ³æ±¤åŒ™å‡ºç”Ÿï¼Œä½ çˆ¸é€äº†ä½ ä¸€åº§é…’åº„å½“æ»¡æœˆç¤¼ã€‚";
        if (stats.luck < 2) return "å‡ºç”Ÿé‚£å¤©åŒ»é™¢åœç”µï¼Œå·®ç‚¹æŠŠä½ æŠ±é”™äº†ï¼Œå¼€å±€ä¸åˆ©ã€‚";
        if (stats.iq > 8) return "å‡ºç”Ÿæ—¶æ²¡å“­ï¼Œåè€Œæ·¡å®šåœ°è§‚å¯Ÿäº†ä¸€ä¸‹æŠ¤å£«çš„å·¥ç‰Œï¼Œéœ‡æƒŠå…¨é™¢ã€‚";
        return "ä½ å‡ºç”Ÿäº†ï¼Œæ˜¯ä¸ªæ™®æ™®é€šé€šçš„å©´å„¿ï¼Œå“­å£°å˜¹äº®ã€‚";
    }

    function getStatEvent() {
        if (stats.money > 8 && Math.random()>0.5) return "å¯ŒäºŒä»£çš„ç”Ÿæ´»æ¯ç‡¥ä¸”ä¹å‘³ï¼Œä½ ä¹°äº†ä¸€è‰˜æ¸¸è‰‡å‘å‘†ã€‚";
        if (stats.face > 8 && Math.random()>0.5) return "èµ°åœ¨è¡—ä¸Šè¢«ä¸€ç¾¤æ˜Ÿæ¢å›´è¿½å µæˆªï¼Œä½ åªèƒ½æˆ´å£ç½©å‡ºé—¨ã€‚";
        if (stats.iq < 3 && Math.random()>0.5) return "ä½ è¯•å›¾è·ŸSiriåµæ¶ï¼Œç»“æœåµè¾“äº†ï¼Œæ°”å¾—ä¸€æ•´å¤©æ²¡åƒé¥­ã€‚";
        if (stats.body > 8) return "ä½ å‚åŠ äº†é©¬æ‹‰æ¾ï¼Œæ‹¿äº†å† å†›ï¼Œè¿˜é¡ºä¾¿å¸®ç»ˆç‚¹çº¿çš„å·¥ä½œäººå‘˜æ¬äº†æ¡Œå­ã€‚";
        return "åŸºäºä½ å½“å‰çš„å±æ€§ï¼Œè¿™ä¸€å¹´è¿‡å¾—ä¸å¥½ä¸åã€‚";
    }

    function addLog(text, isHighlight, isGolden, customClass) {
        const div = document.createElement('div');
        div.className = 'log-item';
        let content = `<span class="age-tag">${age}å²</span> ${text}`;
        if (age === -1) content = `<span class="age-tag" style="background:#95a5a6">å‰ä¸–</span> ${text}`;
        div.innerHTML = content;
        if (isHighlight) div.classList.add('highlight');
        if (isGolden) div.classList.add('golden');
        if (customClass) div.classList.add(customClass);
        document.getElementById('log-container').appendChild(div);
    }

    function resetGame() {
        switchScreen('screen-start');
        document.body.className = '';
        initSetup();
    }
    
    // å¯åŠ¨åˆå§‹åŒ–
    initSetup();
</script>

</body>
</html>